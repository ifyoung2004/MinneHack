{% extends "minigameTemplate.html" %}

{% block minigame %}
<div>Click on the pairs of emojis!</div>
<script type="module">
    function getRandomArbitrary(min, max) {
        return Math.floor(Math.random() * (max - min) + min);
    }

    const items = ["â¤ï¸", "ðŸ§¡", "ðŸ’›", "ðŸ’š", "ðŸ’™", "ðŸ’œ", "ðŸ’•", "ðŸ’–", "ðŸ–¤", "ðŸ¤Ž"]
    let currentClass = "";
    let currentId = "";
    let score = 0;
    let selected = 0;
    const selectedIds = [];

    function matchTrigger(itemDiv) {
        document.querySelector(`#${itemDiv[1]}`).style.border = "1px solid green";
        if (currentClass == itemDiv[0] && currentId != itemDiv[1]) {
            document.querySelectorAll(`.${itemDiv[0]}`).forEach(e => e.remove());
            score++;
            if (score == items.length) {
                hideMinigame()
            }
        }
        if (selectedIds.length > 1) {
            const elem = document.querySelector(`#${selectedIds[0]}`);
            if (elem !== null) {
                elem.style.border = "none";
            }
            selectedIds.shift();
        }
        currentClass = itemDiv[0];
        currentId = itemDiv[1];
        selectedIds.push(currentId);

    }


    const element = document.getElementById('minigameWindow');
    const rect = element.getBoundingClientRect();

    console.log('Top position (Y):', rect.top);
    console.log('Bottom', rect.bottom);
    console.log('Left position (X):', rect.left);
    console.log('Right:', rect.right);
    for (const item of items) {
        for (let i = 0; i < 2; i++) {
            const itemDiv = document.createElement("div");
            itemDiv.innerHTML = item;
            itemDiv.style.position = "absolute";
            itemDiv.style.fontSize = "40px";
            itemDiv.classList.add(item);
            itemDiv.id = item + i;
            itemDiv.style.left = getRandomArbitrary(5, 95) + "%";
            itemDiv.style.top = getRandomArbitrary(5, 95) + "%";
            itemDiv.onclick = () => matchTrigger([itemDiv.classList[0], itemDiv.id]);
            element.appendChild(itemDiv);
        }
    }
</script>
{% endblock %}