{% extends "minigameTemplate.html" %}

{% block minigame %}
<head>
    <style>
        body {
            font-family: Arial;
            text-align: center;
            background: #1a1a1a;
            color: white;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .popup {
            background: #111;
            padding: 20px;
            border-radius: 10px;
            position: relative;
        }

        .closeBtn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 18px;
        }

        canvas {
            background: #222;
            border: 3px solid white;
        }
    </style>
    <script>
    </script>
</head>

<body>
    <button onclick="openPopup()">Play Maze</button>

    <div class="overlay" id="overlay">
        <div class="popup">
            <h2>Reroute Power to Win</h2>
            <canvas id="gameCanvas" width="400" height="400"></canvas>
        </div>
    </div>

<script>
    const overlay = document.getElementById("overlay");
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const tileSize = 40;
    let gameActive = false;

    const maze = [
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,0,0,0,0,1],
        [1,0,1,0,1,0,1,1,0,1],
        [1,0,1,0,0,0,0,1,0,1],
        [1,0,1,1,1,1,0,1,0,1],
        [1,0,0,0,0,1,0,1,0,1],
        [1,1,0,1,0,1,0,1,0,1],
        [1,0,0,1,0,0,0,1,0,1],
        [1,0,1,1,1,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1]
    ];

    const filled = [
        [0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0],
    ]

    let player = { x: 1, y: 1 };
    let goal = { x: 8, y: 8 };

    function openPopup() {
    overlay.style.display = "flex";
    gameActive = true;
    drawMaze();
    }

    function closePopup() {
    overlay.style.display = "none";
    gameActive = false;
    }

    function drawMaze() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Construct maze
        for (let y = 0; y < maze.length; y++) {
            for (let x = 0; x < maze[y].length; x++) {
                ctx.fillStyle = maze[y][x] === 1 ? "#555" : "#222";
                ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
            }
        }

        // Fill in visited squares
        for (let y = 0; y < filled.length; y++) {
            for (let x = 0; x < filled[y].length; x++) {
                if (filled[y][x] == 1) {
                    ctx.fillStyle = "yellow";
                    ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
                }
            }
        }

        // Goal
        ctx.fillStyle = "yellow";
        ctx.fillRect(goal.x * tileSize, goal.y * tileSize, tileSize, tileSize);

        // Player
        ctx.fillStyle = "yellow";
        ctx.fillRect(player.x * tileSize, player.y * tileSize, tileSize, tileSize);
    }

    function move(dx, dy) {
        if (!gameActive) return;

        filled[player.y][player.x] = 1;

        const newX = player.x + dx;
        const newY = player.y + dy;

        if (maze[newY][newX] === 0) {
            player.x = newX;
            player.y = newY;
        }

        if (player.x === goal.x && player.y === goal.y) {
            hideMinigame()
            // filled = [
            //     [0,0,0,0,0,0,0,0,0,0],
            //     [0,0,0,0,0,0,0,0,0,0],
            //     [0,0,0,0,0,0,0,0,0,0],
            //     [0,0,0,0,0,0,0,0,0,0],
            //     [0,0,0,0,0,0,0,0,0,0],
            //     [0,0,0,0,0,0,0,0,0,0],
            //     [0,0,0,0,0,0,0,0,0,0],
            //     [0,0,0,0,0,0,0,0,0,0],
            //     [0,0,0,0,0,0,0,0,0,0],
            //     [0,0,0,0,0,0,0,0,0,0],
            // ]
            // player = { x: 1, y: 1 };
        }

        drawMaze();
    }

    document.addEventListener("keydown", e => {
        switch (e.key) {
            case "ArrowUp": move(0, -1); break;
            case "ArrowDown": move(0, 1); break;
            case "ArrowLeft": move(-1, 0); break;
            case "ArrowRight": move(1, 0); break;
        }
    });
</script>

</body>

</html>

{% endblock %}